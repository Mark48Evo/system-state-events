{"version":3,"file":"system-state-events.js","sources":["../src/index.js"],"sourcesContent":["import Debug from 'debug';\nimport amqplib from 'amqplib';\nimport { createClient } from 'redis';\nimport SystemEvents from '@mark48evo/system-events';\nimport SystemState from '@mark48evo/system-state';\n\nconst debug = Debug('system:state:events');\n\nconst config = {\n  host: process.env.RABBITMQ_HOST || 'amqp://localhost',\n  redisURL: process.env.REDIS_URL || 'redis://127.0.0.1:6379/3',\n};\n\nasync function main() {\n  const connect = await amqplib.connect(config.host);\n  const channel = await connect.createChannel();\n  const redis = createClient(config.redisURL);\n\n  const systemEvents = await SystemEvents(channel, { consume: false });\n  const systemState = await SystemState(redis, channel);\n\n  systemState.on('*', async (stateName, value) => {\n    debug(`Published \"state.change\" for state: \"${stateName}\"`);\n\n    systemEvents.publish('state.change', {\n      stateName,\n      value,\n    });\n  });\n}\n\nmain();\n"],"names":["debug","Debug","config","process","env","RABBITMQ_HOST","REDIS_URL","main","connect","amqplib","host","channel","createChannel","redis","createClient","redisURL","systemEvents","SystemEvents","systemState","SystemState","on","stateName","value","publish"],"mappings":";;;;;;;;;;;AAMA,MAAMA,QAAQC,MAAM,qBAAN,CAAd;AAEA,MAAMC,SAAS;QACPC,QAAQC,GAAR,CAAYC,aAAZ,IAA6B,kBADtB;YAEHF,QAAQC,GAAR,CAAYE,SAAZ,IAAyB;CAFrC;;AAKA,eAAeC,IAAf,GAAsB;QACdC,UAAU,MAAMC,QAAQD,OAAR,CAAgBN,OAAOQ,IAAvB,CAAtB;QACMC,UAAU,MAAMH,QAAQI,aAAR,EAAtB;QACMC,WAAQC,mBAAaZ,OAAOa,QAApB,CAAd;QAEMC,eAAe,MAAMC,aAAaN,OAAb,EAAsB;aAAW;GAAjC,CAA3B;QACMO,cAAc,MAAMC,YAAYN,QAAZ,EAAmBF,OAAnB,CAA1B;cAEYS,EAAZ,CAAe,GAAf,EAAoB,OAAOC,SAAP,EAAkBC,KAAlB,KAA4B;UACvC,wCAAuCD,SAAU,GAAxD;iBAEaE,OAAb,CAAqB,cAArB,EAAqC;eAAA;;KAArC;GAHF;;;AAUFhB"}